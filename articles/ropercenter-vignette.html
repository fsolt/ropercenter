<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ropercenter">
<title>ropercenter: Reproducible Retrieval of Roper Center Datasets • ropercenter</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ropercenter: Reproducible Retrieval of Roper Center Datasets">
<meta property="og:description" content="ropercenter">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ropercenter</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ropercenter-vignette.html">ropercenter: Reproducible Retrieval of Roper Center Datasets</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/fsolt/ropercenter/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>ropercenter: Reproducible Retrieval of Roper Center Datasets</h1>
                        <h4 data-toc-skip class="author">Frederick
Solt</h4>
            
            <h4 data-toc-skip class="date">2023-07-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/fsolt/ropercenter/blob/HEAD/vignettes/ropercenter-vignette.Rmd" class="external-link"><code>vignettes/ropercenter-vignette.Rmd</code></a></small>
      <div class="d-none name"><code>ropercenter-vignette.Rmd</code></div>
    </div>

    
    
<p>The <a href="https://ropercenter.cornell.edu" class="external-link">Roper Center for Public
Opinion Research</a>, in its own words, works “to collect, preserve, and
disseminate public opinion data; to serve as a resource to help improve
the practice of survey research; and to broaden the understanding of
public opinion through the use of survey data in the United States and
around the world.” It maintains the largest archive of public opinion
data in existence, holding data dating back to the 1930s and from over
100 countries. Researchers taking advantage of these datasets, however,
are caught in a bind. The terms and conditions for downloading any Roper
Center dataset state that datasets “may not be resold or
re-disseminated.”<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The terms &lt;em&gt;do&lt;/em&gt; include the exception that
“researchers who are actively collaborating with individuals at
non-member institutions may provide a copy of relevant data sets to
their collaborators solely for their private use in connection with and
for the duration of the project, after which they will return or destroy
such material,” but the limitation to active collaboration renders this
inadequate for the public provision of materials for reproducibility.&lt;/p&gt;"><sup>1</sup></a> But to ensure that one’s work can be
reproduced, assessed, and built upon by others, one must provide access
to the raw data one employed.</p>
<p>The <code>ropercenter</code> package cuts this knot by providing
programmatic, reproducible access to specified Roper Center datasets
from within R for <a href="https://ropercenter.cornell.edu/ipoll/login" class="external-link">registered users</a>
at the Roper Center’s <a href="https://ropercenter.cornell.edu/membership/list-members" class="external-link">member
institutions</a>.</p>
<p>Please remember that by using Roper Center services, you accept all
of the Center’s <a href="https://ropercenter.cornell.edu/end-user-terms-and-conditions" class="external-link">Terms
and Conditions</a>.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>The <code>ropercenter</code> package interacts with the Roper Center
website using the Firefox browser. <a href="https://www.mozilla.org/firefox/" class="external-link">Get Firefox here</a>.</p>
<p>When used interactively, the <code>roper_download</code> function
will ask for the login information required by the Roper Center: the
registered user’s affiliation, email, and password. After that
information is input once, it will be entered automatically for any
other download requests made in the same session. To change this contact
information within a session, one may set the argument
<code>reset</code> to <code>TRUE</code> when running
<code>roper_download</code> again, and the function will again request
the required information.</p>
<p>An optional, but highly recommended, setup step is to add the
information the Roper Center requires to your <a href="https://www.statmethods.net/interface/customizing.html" class="external-link">.Rprofile</a>
as in the following example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"roper_email"</span> <span class="op">=</span> <span class="st">"juanita-herrera@uppermidwest.edu"</span>,</span>
<span>        <span class="st">"roper_password"</span> <span class="op">=</span> <span class="st">"password123!"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>roper_download</code> function will then access the
information it needs to pass on to the Roper Center by default. This
means that researchers will not have to expose their info in their R
scripts and that others reproducing their results later—given that they
have registered as users with the Roper Center—will be able to execute
those R scripts without modification. (They will, however, need to enter
their own information either interactively or in their own .Rprofiles, a
detail that should be noted in the reproducibility materials to avoid
confusion.)</p>
</div>
<div class="section level2">
<h2 id="use">Use<a class="anchor" aria-label="anchor" href="#use"></a>
</h2>
<p>The <code>roper_download</code> function (1) simulates a visit to the
Roper Center’s sign-in page, (2) enters the required information to sign
in, (3) navigates to a specified dataset and downloads the dataset’s
files, and, optionally but by default, (4) converts the dataset’s Stata-
or SPSS-formated files to <code>.Rdata</code> format.</p>
<p>Datasets are specified using the <code>file_id</code> argument. The
Roper Center uses a unique ‘archive number’ to identify each of its
datasets; this number is consistently listed alongside the dataset’s
name and under the Study Info tab. For this <a href="https://ropercenter.cornell.edu/ipoll/study/31117412" class="external-link">Fox News
poll on the 2020 U.S. presidential election</a>, for example, the file
id is 31117412:</p>
<p><img src="roper_31117412.png" style="width: 100%;"></p>
<p>To reproducibly download this dataset:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/roper_download.html">roper_download</a></span><span class="op">(</span>file_id <span class="op">=</span> <span class="st">"31117412"</span>,</span>
<span>               download_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># remember to specify a directory for your download</span></span></code></pre></div>
<p>Most older surveys also have a Roper ‘historical archive number’ that
may also be used as the file id. This <a href="https://ropercenter.cornell.edu/ipoll/study/USORCCNN2015-010" class="external-link">CNN/ORC
poll on the 2016 U.S. presidential election</a> can be downloaded using
either its archive number, 31095595, or its historical archive number,
USORCCNN2015-010, as the file id:</p>
<p><img src="roper_orccnn2015-010.png" style="width: 100%;"></p>
<p>Downloading with the historical archive number as the file id:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/roper_download.html">roper_download</a></span><span class="op">(</span>file_id <span class="op">=</span> <span class="st">"USORCCNN2015-010"</span>,</span>
<span>               download_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># remember to specify a directory for your download</span></span></code></pre></div>
<p>Multiple datasets may be downloaded from the same research area in a
single command by passing a vector of ids to <code>file_id</code>. The
following will download both of the above-described polls:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/roper_download.html">roper_download</a></span><span class="op">(</span>file_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"31117412"</span>, <span class="st">"USORCCNN2015-010"</span><span class="op">)</span>,</span>
<span>               download_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># remember to specify a directory for your download</span></span></code></pre></div>
<p>After the needed datasets are downloaded, if they are in Stata or
SPSS format, they are by default converted to <code>.RData</code> format
(via <code><a href="https://haven.tidyverse.org/reference/read_dta.html" class="external-link">haven::read_dta</a></code> if possible,
<code><a href="https://haven.tidyverse.org/reference/read_spss.html" class="external-link">haven::read_por</a></code> or <code><a href="https://rdrr.io/pkg/foreign/man/read.spss.html" class="external-link">foreign::read.spss</a></code>
otherwise) and ready to be loaded into R using <code><a href="https://rdrr.io/r/base/load.html" class="external-link">load()</a></code> or
<code><a href="https://rdrr.io/pkg/rio/man/import.html" class="external-link">rio::import()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">orccnn2015_010</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html" class="external-link">import</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"USORCCNN2015-010"</span>,<span class="st">"USORCCNN2015-010.RData"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For many older surveys, however, no Stata- or SPSS-formatted datasets
are available, only <code>.dat</code> ASCII files. The next section
describes how to use <code>ropercenter</code>’s <code>read_ascii</code>
function to make this data usable.</p>
</div>
<div class="section level2">
<h2 id="advanced-use-ascii-datasets">Advanced Use: ASCII Datasets<a class="anchor" aria-label="anchor" href="#advanced-use-ascii-datasets"></a>
</h2>
<p>Many older Roper Center datasets are available only in ASCII format,
which is notoriously difficult to work with. The <code>read_ascii</code>
function facilitates the process of extracting selected variables from
ASCII datasets. For single-card files, such as this Gallup Poll from
June 1982, one can simply identify the names, positions, and widths of
the needed variables from the codebook and pass them to
<code>read_ascii</code>’s <code>var_names</code>,
<code>var_positions</code>, and <code>var_widths</code> arguments. The
resulting data frame will include these variables plus a variable for
the respondent id number and one that encodes the raw data as a single
string.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/roper_download.html">roper_download</a></span><span class="op">(</span><span class="st">"USAIPO1982-1197G"</span>, <span class="co"># Gallup Poll for June 25-28, 1982 (ASCII only)</span></span>
<span>               download_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="co"># remember to specify a directory for your download</span></span>
<span></span>
<span><span class="va">gallup1982</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ascii.html">read_ascii</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"USAIPO1982-1197G"</span>,</span>
<span>                                          <span class="st">"1197.dat"</span><span class="op">)</span>,</span>
<span>                         var_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q09j"</span>, <span class="st">"weight"</span><span class="op">)</span>,</span>
<span>                         var_positions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">38</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                         var_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Multicard datasets are more complicated. In the best case, the file
contains one line per card per respondent; then, the user can extract
the needed variables by adding only the <code>var_cards</code> and
<code>total_cards</code> arguments. When this condition is
violated—there is not a line for every card for every respondent, or
there are extra lines—the <code>read_ascii</code> function will throw an
error and request the additional arguments <code>card_pattern</code> and
<code>respondent_pattern</code>. These take <a href="https://r4ds.had.co.nz/strings.html#matching-patterns-with-regular-expressions" class="external-link">regular
expressions</a> that match the card and respondent identifiers on each
line in the original file (note that <a href="https://www.regextutorial.org/positive-and-negative-lookbehind-assertions.php" class="external-link">look-behind
assertions</a> are often particularly handy for constructing these
regexs). Either way, the resulting data frame will include the variables
specified in the <code>var_</code> arguments, a variable for the
respondent id number, and as many additional variables as cards in the
file, each of which encodes the raw data on that card as a single
string.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/roper_download.html">roper_download</a></span><span class="op">(</span><span class="st">"USAIPOCNUS1996-9603008"</span>, <span class="co"># Gallup/CNN/USA Today Poll: Politics/1996 Election (ASCII only)</span></span>
<span>               download_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="co"># remember to specify a directory for your download</span></span>
<span></span>
<span><span class="va">gallup1996</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ascii.html">read_ascii</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"USAIPOCNUS1996-9603008"</span>,</span>
<span>                                          <span class="st">"a9603008.dat"</span><span class="op">)</span>,</span>
<span>                         var_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q43a"</span>, <span class="st">"q44"</span>, <span class="st">"weight"</span><span class="op">)</span>,</span>
<span>                         var_cards <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                         var_positions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">62</span>, <span class="fl">64</span>, <span class="fl">13</span><span class="op">)</span>,</span>
<span>                         var_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                         total_cards <span class="op">=</span> <span class="fl">7</span>,</span>
<span>                         card_pattern <span class="op">=</span> <span class="st">"(?&lt;=^.{10})\\d"</span>, <span class="co"># a digit, preceded by the start of the line and ten other characters</span></span>
<span>                         respondent_pattern <span class="op">=</span> <span class="st">"(?&lt;=^\\s{2})\\d{4}"</span><span class="op">)</span> <span class="co"># four digits, preceded by the start of the line and two whitespace characters</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Frederick Solt.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
